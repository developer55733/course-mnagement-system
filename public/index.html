<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>IT Course Management System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Mobile-specific optimizations -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" sizes="192x192" href="/icon-192.png">
    <style>
        /* Mobile-specific styles */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }
        
        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .mobile-nav-content {
            background: white;
            padding: 20px;
            margin-top: 60px;
        }
        
        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .mobile-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }
        
        .mobile-nav-tabs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .mobile-nav-tab {
            padding: 15px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .mobile-nav-tab:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        .mobile-nav-tab.active {
            background: #1976d2;
            color: white;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .container {
                padding: 0;
                border-radius: 0;
                box-shadow: none;
                min-height: 100vh;
            }
            
            header {
                padding: 15px;
                flex-wrap: wrap;
            }
            
            .tabs {
                display: none;
            }
            
            body {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1><i class="fas fa-laptop-code"></i> IT Course Management System</h1>
                <p>Student Portal for Modules, Tests, and Lecturer Contact</p>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- User Profile Header (shown when logged in) -->
            <div class="user-profile-header hidden" id="user-profile-header">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-details-popup" id="user-details-popup">
                    <div class="user-profile-header-popup">
                        <div class="profile-picture-container">
                            <img id="profile-picture" src="https://picsum.photos/seed/default-avatar/100/100.jpg" alt="Profile Picture" class="profile-picture">
                            <div class="profile-picture-overlay">
                                <i class="fas fa-camera"></i>
                                <span>Change Photo</span>
                            </div>
                            <input type="file" id="profile-picture-input" accept="image/*" style="display: none;">
                        </div>
                        <div class="profile-name-section">
                            <h3 id="popup-name">John Doe</h3>
                            <span id="popup-account-type" class="account-type-badge">Student</span>
                        </div>
                    </div>
                    <div class="user-detail-item">
                        <span class="user-detail-label"><i class="fas fa-id-card"></i> Registration No:</span>
                        <span class="user-detail-value" id="popup-reg-no">IT2023001</span>
                    </div>
                    <div class="user-detail-item">
                        <span class="user-detail-label"><i class="fas fa-envelope"></i> Gmail:</span>
                        <span class="user-detail-value" id="popup-email">john@student.edu</span>
                    </div>
                    <div class="user-detail-item">
                        <span class="user-detail-label"><i class="fas fa-graduation-cap"></i> Student ID:</span>
                        <span class="user-detail-value" id="popup-student-id">IT2023001</span>
                    </div>
                    <div class="user-detail-item">
                        <span class="user-detail-label"><i class="fas fa-user-tag"></i> Account Type:</span>
                        <span class="user-detail-value" id="popup-account-type-detail">Student</span>
                        <span class="status-indicator" id="admin-status">
                            <span class="status-dot active"></span>
                            <span class="status-text">Active</span>
                        </span>
                    </div>
                    <div class="user-detail-actions" id="admin-actions" style="display: none;">
                        <button class="admin-action-btn delete-btn" onclick="deleteAccount()">
                            <i class="fas fa-trash"></i> Delete Account
                        </button>
                        <button class="logout-btn" onclick="logout()" title="Logout (Ctrl+L)" aria-label="Logout from the system">
                            <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                        </button>
                    </div>
                    <div class="user-detail-actions" id="user-actions">
                        <button class="logout-btn" onclick="logout()" title="Logout (Ctrl+L)" aria-label="Logout from the system">
                            <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="login">Login</button>
            <button class="tab-btn" data-tab="register">Register</button>
            <button class="tab-btn" data-tab="about">About</button>
            <button class="tab-btn" data-tab="contact">Contact</button>
            <button class="tab-btn" data-tab="zoom-meeting" id="zoom-tab">Zoom Meeting</button>
            <button class="tab-btn" data-tab="news" id="news-tab">News & Info</button>
            <button class="tab-btn" data-tab="ads" id="ads-tab">Ads</button>
            <button class="tab-btn hidden" data-tab="dashboard" id="dashboard-tab">Dashboard</button>
            <button class="tab-btn hidden" data-tab="discussion-forum" id="discussion-tab">Discussion Forum</button>
            <button class="tab-btn hidden" data-tab="assignments" id="assignments-tab">
                <i class="fas fa-tasks"></i> Assignments
                <span class="notification-badge hidden" id="assignment-notification-badge">
                    <i class="fas fa-exclamation-circle"></i>
                </span>
            </button>
        </div>
        
        <!-- About Page -->
        <div class="tab-content" id="about">
            <div class="about-container">
                <div class="about-header">
                    <h2 class="page-title"><i class="fas fa-info-circle"></i> About IT Course Management System</h2>
                    <p class="about-subtitle">A comprehensive platform for modern educational management</p>
                </div>
                
                <div class="about-grid">
                    <!-- Developer Info Card -->
                    <div class="about-card-small">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="card-content">
                            <h3>Developer</h3>
                            <p><strong>Chrispin Golden</strong></p>
                            <p>System Developer & Administrator</p>
                            <a href="mailto:chrispingolden@gmail.com" class="contact-link">
                                <i class="fas fa-envelope"></i> chrispingolden@gmail.com
                            </a>
                        </div>
                    </div>

                    <!-- System Overview Card -->
                    <div class="about-card-small">
                        <div class="card-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="card-content">
                            <h3>System Purpose</h3>
                            <p>Comprehensive platform for managing:</p>
                            <ul class="feature-list">
                                <li>Course modules & schedules</li>
                                <li>Student progress tracking</li>
                                <li>Academic communication</li>
                                <li>Administrative tools</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Key Features Card -->
                    <div class="about-card-small">
                        <div class="card-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="card-content">
                            <h3>Core Features</h3>
                            <ul class="feature-list">
                                <li>Student Dashboard</li>
                                <li>Admin Panel</li>
                                <li>Discussion Forum</li>
                                <li>Assignment Management</li>
                                <li>Real-time Updates</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Technology Stack Card -->
                    <div class="about-card-small">
                        <div class="card-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="card-content">
                            <h3>Technology</h3>
                            <div class="tech-stack">
                                <span class="tech-item">HTML/CSS/JS</span>
                                <span class="tech-item">Node.js</span>
                                <span class="tech-item">Express.js</span>
                                <span class="tech-item">MySQL</span>
                                <span class="tech-item">Railway.app</span>
                            </div>
                        </div>
                    </div>

                    <!-- Future Plans Card -->
                    <div class="about-card-small">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-content">
                            <h3>Coming Soon</h3>
                            <ul class="feature-list">
                                <li>Mobile Apps</li>
                                <li>WhatsApp Integration</li>
                                <li>Video Classes</li>
                                <li>Analytics Dashboard</li>
                                <li>Multi-language Support</li>
                            </ul>
                        </div>
                    </div>

                    <!-- System Stats Card -->
                    <div class="about-card-small">
                        <div class="card-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="card-content">
                            <h3>System Capabilities</h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <i class="fas fa-users"></i>
                                    <span>Multi-user Support</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Secure Authentication</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-database"></i>
                                    <span>Cloud Database</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-mobile-alt"></i>
                                    <span>Responsive Design</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Info -->
                <div class="about-footer">
                    <div class="footer-section">
                        <h4><i class="fas fa-code"></i> Development</h4>
                        <p>Built with modern web technologies for optimal performance and user experience.</p>
                    </div>
                    <div class="footer-section">
                        <h4><i class="fas fa-graduation-cap"></i> Education</h4>
                        <p>Designed to streamline educational processes and enhance learning outcomes.</p>
                    </div>
                    <div class="footer-section">
                        <h4><i class="fas fa-rocket"></i> Innovation</h4>
                        <p>Continuously evolving with new features and improvements based on user feedback.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contact Page -->
        <div class="tab-content" id="contact">
            <div class="page-container">
                <h2 class="page-title"><i class="fas fa-envelope"></i> Contact Us</h2>
                
                <div class="contact-container">
                    <div class="contact-form-section">
                        <h3>Send us a Message</h3>
                        <p>If you have any issues, questions, or suggestions, please fill out the form below and we'll get back to you shortly.</p>
                        
                        <form id="contact-form">
                            <div class="form-group">
                                <label for="contact-name">Full Name</label>
                                <input type="text" id="contact-name" required placeholder="Enter your full name">
                            </div>
                            
                            <div class="form-group">
                                <label for="contact-email">Email Address</label>
                                <input type="email" id="contact-email" required placeholder="Enter your email address">
                            </div>
                            
                            <div class="form-group">
                                <label for="contact-phone">Phone Number</label>
                                <input type="tel" id="contact-phone" required placeholder="Enter your phone number (for WhatsApp)">
                                <small class="whatsapp-hint">
                                    <i class="fab fa-whatsapp"></i> Message will be sent via WhatsApp automatically
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label for="contact-subject">Subject</label>
                                <select id="contact-subject" required>
                                    <option value="">Select a subject</option>
                                    <option value="technical_issue">Technical Issue</option>
                                    <option value="course_inquiry">Course Inquiry</option>
                                    <option value="general_feedback">General Feedback</option>
                                    <option value="feature_request">Feature Request</option>
                                    <option value="bug_report">Bug Report</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="contact-message">Message</label>
                                <textarea id="contact-message" required placeholder="Please describe your issue or message..." rows="6"></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-submit">
                                    <i class="fas fa-paper-plane"></i> Send Message
                                </button>
                                <button type="button" class="btn btn-whatsapp" id="whatsapp-btn">
                                    <i class="fab fa-whatsapp"></i> Send via WhatsApp
                                </button>
                            </div>
                            <div class="message" id="contact-message-status"></div>
                        </form>
                    </div>
                    
                    <div class="contact-info-section">
                        <h3>Contact Information</h3>
                        
                        <div class="contact-info-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-details">
                                <h4>Email</h4>
                                <p><a href="mailto:chrispingolden@gmail.com">chrispingolden@gmail.com</a></p>
                                <p class="contact-note">Response time: 24-48 hours</p>
                            </div>
                        </div>
                        
                        <div class="contact-info-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="contact-details">
                                <h4>Phone Support</h4>
                                <p>Available for urgent issues</p>
                                <p class="contact-note">Business hours: Monday - Friday, 9:00 AM - 5:00 PM</p>
                            </div>
                        </div>
                        
                        <div class="contact-info-item">
                            <div class="contact-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="contact-details">
                                <h4>Support Hours</h4>
                                <p>Monday - Friday: 9:00 AM - 5:00 PM</p>
                                <p>Saturday - Sunday: Closed</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Zoom Meeting Tab -->
        <div class="tab-content" id="zoom-meeting">
            <div class="zoom-container">
                <div class="zoom-header">
                    <h2 class="page-title"><i class="fas fa-video"></i> Zoom Meeting</h2>
                    <p class="zoom-subtitle">Quick access to your virtual classes</p>
                </div>
                
                <div class="zoom-grid">
                    <!-- Join Meeting Card -->
                    <div class="zoom-card">
                        <div class="card-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="card-content">
                            <h3>Join Meeting</h3>
                            <form id="zoom-meeting-form" class="zoom-form">
                                <div class="form-group">
                                    <input type="url" id="zoom-link" required placeholder="Meeting link (https://zoom.us/j/...)" class="form-input">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <input type="text" id="meeting-name" required placeholder="Your name" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <input type="password" id="meeting-password" placeholder="Password (optional)" class="form-input">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-small">
                                    <i class="fas fa-sign-in-alt"></i> Join Now
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Quick Tips Card -->
                    <div class="zoom-card">
                        <div class="card-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="card-content">
                            <h3>Quick Tips</h3>
                            <ul class="tips-list">
                                <li><i class="fas fa-wifi"></i> Stable internet</li>
                                <li><i class="fas fa-microphone"></i> Test audio</li>
                                <li><i class="fas fa-camera"></i> Check camera</li>
                                <li><i class="fas fa-clock"></i> Join early</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Meeting Info Card -->
                    <div class="zoom-card">
                        <div class="card-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="card-content">
                            <h3>How to Join</h3>
                            <ol class="steps-list">
                                <li>Copy meeting link</li>
                                <li>Paste in field above</li>
                                <li>Enter your name</li>
                                <li>Click "Join Now"</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Support Card -->
                    <div class="zoom-card">
                        <div class="card-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div class="card-content">
                            <h3>Need Help?</h3>
                            <p>Having trouble joining?</p>
                            <button class="btn btn-outline-primary btn-small">
                                <i class="fas fa-question-circle"></i> Get Support
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Footer Info -->
                <div class="zoom-footer">
                    <div class="footer-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Secure connection</span>
                    </div>
                    <div class="footer-item">
                        <i class="fas fa-users"></i>
                        <span>Multiple participants</span>
                    </div>
                    <div class="footer-item">
                        <i class="fas fa-desktop"></i>
                        <span>Screen sharing available</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- News & Information Tab -->
        <div class="tab-content" id="news">
            <div class="news-container">
                <div class="news-header">
                    <h2 class="page-title"><i class="fas fa-newspaper"></i> News & Information</h2>
                    <p class="news-subtitle">Stay updated with the latest announcements and events</p>
                </div>
                
                <div class="news-filters">
                    <div class="filter-group">
                        <select id="news-category-filter" class="filter-select">
                            <option value="">All Categories</option>
                            <option value="general">General</option>
                            <option value="academic">Academic</option>
                            <option value="events">Events</option>
                            <option value="announcements">Announcements</option>
                        </select>
                        <select id="news-priority-filter" class="filter-select">
                            <option value="">All Priorities</option>
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                </div>
                
                <div class="news-list" id="news-list">
                    <div class="no-news-message">
                        <i class="fas fa-newspaper"></i>
                        <p>No news articles available yet.</p>
                        <p>Admin will post news and updates here.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ads Tab -->
        <div class="tab-content" id="ads">
            <div class="ads-container">
                <div class="ads-header">
                    <h2 class="page-title"><i class="fas fa-ad"></i> Advertisements</h2>
                    <p class="ads-subtitle">Discover relevant products and services</p>
                </div>
                
                <div class="ads-grid" id="ads-grid">
                    <!-- Video Ads Section -->
                    <div class="ads-section">
                        <h3><i class="fas fa-video"></i> Video Ads</h3>
                        <div class="video-ads-container" id="video-ads">
                            <div class="no-ads-message">
                                <i class="fas fa-video"></i>
                                <p>No video ads available at the moment.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Banner Ads Section -->
                    <div class="ads-section">
                        <h3><i class="fas fa-image"></i> Banner Ads</h3>
                        <div class="banner-ads-container" id="banner-ads">
                            <div class="no-ads-message">
                                <i class="fas fa-image"></i>
                                <p>No banner ads available at the moment.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Popup Ads Section -->
                    <div class="ads-section">
                        <h3><i class="fas fa-window-restore"></i> Popup Ads</h3>
                        <div class="popup-ads-container" id="popup-ads">
                            <div class="no-ads-message">
                                <i class="fas fa-window-restore"></i>
                                <p>No popup ads available at the moment.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Position-based Ads -->
                    <div class="ads-section">
                        <h3><i class="fas fa-map-marker-alt"></i> Position-based Ads</h3>
                        <div class="position-ads-container">
                            <div class="position-section">
                                <h4><i class="fas fa-arrow-up"></i> Top Position</h4>
                                <div id="top-ads">
                                    <div class="no-ads-message">
                                        <p>No top position ads available.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="position-section">
                                <h4><i class="fas fa-arrows-alt-h"></i> Sidebar Position</h4>
                                <div id="sidebar-ads">
                                    <div class="no-ads-message">
                                        <p>No sidebar position ads available.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="position-section">
                                <h4><i class="fas fa-arrow-down"></i> Bottom Position</h4>
                                <div id="bottom-ads">
                                    <div class="no-ads-message">
                                        <p>No bottom position ads available.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="position-section">
                                <h4><i class="fas fa-window-restore"></i> Popup Position</h4>
                                <div id="popup-position-ads">
                                    <div class="no-ads-message">
                                        <p>No popup position ads available.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Login Tab -->
        <div class="tab-content active" id="login">
            <div class="login-container">
                <div class="login-header">
                    <h2 class="login-title"><i class="fas fa-sign-in-alt"></i> Student Login</h2>
                    <p class="login-subtitle">Access your course portal</p>
                </div>
                <div class="message" id="login-message"></div>
                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="login-email" class="login-label">
                            <i class="fas fa-user"></i> Student ID / Email
                        </label>
                        <input type="text" id="login-email" required placeholder="Enter your student ID or email" class="login-input">
                    </div>
                    <div class="form-group">
                        <label for="login-password" class="login-label">
                            <i class="fas fa-lock"></i> Password
                        </label>
                        <input type="password" id="login-password" required placeholder="Enter your password" class="login-input">
                    </div>
                    <button type="submit" class="btn btn-login">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <div class="login-footer">
                    <p>Don't have an account? <a href="#" id="go-to-register" class="register-link">Register here</a></p>
                </div>
            </div>
        </div>
        
        <!-- Register Tab -->
        <div class="tab-content" id="register">
            <div class="register-container">
                <div class="register-header">
                    <h2 class="register-title"><i class="fas fa-user-plus"></i> Student Registration</h2>
                    <p class="register-subtitle">Create your account to access course materials</p>
                </div>
                <div class="message" id="register-message"></div>
                <form id="register-form" class="register-form">
                    <div class="register-grid">
                        <!-- Left Column -->
                        <div class="register-column">
                            <div class="form-group">
                                <label for="reg-name" class="form-label">
                                    <i class="fas fa-user"></i> Full Name
                                </label>
                                <input type="text" id="reg-name" required placeholder="Enter your full name" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="reg-email" class="form-label">
                                    <i class="fas fa-envelope"></i> Email Address
                                </label>
                                <input type="email" id="reg-email" required placeholder="Enter your email" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="reg-student-id" class="form-label">
                                    <i class="fas fa-id-card"></i> Student ID
                                </label>
                                <input type="text" id="reg-student-id" required placeholder="NIT/CICT/2024/1434" 
                                       pattern="[A-Z]+/[A-Z]+/[0-9]{4}/[0-9]{4}" class="form-input">
                                <small class="format-hint">
                                    <i class="fas fa-info-circle"></i> Format: NIT/CICT/YEAR/FOUR-DIGITS
                                </small>
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div class="register-column">
                            <div class="form-group">
                                <label for="reg-password" class="form-label">
                                    <i class="fas fa-lock"></i> Password
                                </label>
                                <input type="password" id="reg-password" required placeholder="Create a password" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="reg-confirm-password" class="form-label">
                                    <i class="fas fa-lock"></i> Confirm Password
                                </label>
                                <input type="password" id="reg-confirm-password" required placeholder="Confirm your password" class="form-input">
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-register">
                                    <i class="fas fa-user-plus"></i> Create Account
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="register-footer">
                    <p>Already have an account? <a href="#" id="go-to-login" class="login-link">Login here</a></p>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content" id="dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    Welcome, <span class="user-name" id="dashboard-username">Student Name</span>
                    <span id="admin-badge" class="admin-badge hidden">Admin</span>
                </div>
                <div class="header-actions">
                    <button id="admin-panel-btn" class="btn btn-admin-panel hidden" onclick="window.open('/admin', '_blank')">
                        <i class="fas fa-cog"></i> Admin Panel
                    </button>
                    <button class="logout-btn" id="logout-btn" onclick="testLogout()" title="Logout (Ctrl+L)" aria-label="Logout from system">Logout <i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <!-- Modules Card -->
                <div class="card card-modules">
                    <h3><i class="fas fa-book"></i> Course Modules</h3>
                    <div class="table-container modules-wrapper">
                        <table class="modules-table">
                            <thead>
                                <tr>
                                    <th data-priority="1">Code</th>
                                    <th data-priority="2">Module Name</th>
                                    <th data-priority="3">Credits</th>
                                    <th data-priority="4">Lecturer</th>
                                </tr>
                            </thead>
                            <tbody id="modules-tbody">
                                <tr>
                                    <td data-label="Code:">IT101</td>
                                    <td data-label="Module:">Introduction to Programming</td>
                                    <td data-label="Credits:">3</td>
                                    <td data-label="Lecturer:">Dr. Smith</td>
                                </tr>
                                <tr>
                                    <td data-label="Code:">IT102</td>
                                    <td data-label="Module:">Web Development Fundamentals</td>
                                    <td data-label="Credits:">3</td>
                                    <td data-label="Lecturer:">Dr. Johnson</td>
                                </tr>
                                <tr>
                                    <td data-label="Code:">IT103</td>
                                    <td data-label="Module:">Database Management Systems</td>
                                    <td data-label="Credits:">3</td>
                                    <td data-label="Lecturer:">Dr. Williams</td>
                                </tr>
                                <tr>
                                    <td data-label="Code:">IT104</td>
                                    <td data-label="Module:">Data Structures & Algorithms</td>
                                    <td data-label="Credits:">3</td>
                                    <td data-label="Lecturer:">Dr. Brown</td>
                                </tr>
                                <tr>
                                    <td data-label="Code:">IT105</td>
                                    <td data-label="Module:">Computer Networks</td>
                                    <td data-label="Credits:">3</td>
                                    <td data-label="Lecturer:">Dr. Davis</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Lecturers Card -->
                <div class="card card-lecturers">
                    <h3><i class="fas fa-chalkboard-teacher"></i> Course Lecturers</h3>
                    <div class="table-container lecturers-wrapper">
                        <table class="lecturers-table">
                            <thead>
                                <tr>
                                    <th data-priority="1">Name</th>
                                    <th data-priority="2">Module</th>
                                    <th data-priority="3">Phone</th>
                                    <th id="admin-lecturer-action-header" class="hidden">Action</th>
                                </tr>
                            </thead>
                            <tbody id="lecturers-list">
                                <!-- Lecturers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Admin Controls for Lecturers (Only visible to admins) -->
                    <div class="admin-controls" id="lecturer-admin-controls">
                        <h4><i class="fas fa-user-shield"></i> Admin: Manage Lecturers</h4>
                        <form id="add-lecturer-form">
                            <div class="form-group">
                                <label for="lecturer-name">Lecturer Name</label>
                                <input type="text" id="lecturer-name" placeholder="Enter lecturer's full name">
                            </div>
                            <div class="form-group">
                                <label for="lecturer-module">Module</label>
                                <select id="lecturer-module">
                                    <option value="">Select Module</option>
                                    <option value="IT101 - Introduction to Programming">IT101 - Introduction to Programming</option>
                                    <option value="IT102 - Web Development Fundamentals">IT102 - Web Development Fundamentals</option>
                                    <option value="IT103 - Database Management Systems">IT103 - Database Management Systems</option>
                                    <option value="IT104 - Data Structures & Algorithms">IT104 - Data Structures & Algorithms</option>
                                    <option value="IT105 - Computer Networks">IT105 - Computer Networks</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="lecturer-phone">Phone Number</label>
                                <input type="text" id="lecturer-phone" placeholder="Enter phone number with country code">
                            </div>
                            <button type="submit" class="btn btn-admin">Add Lecturer</button>
                        </form>
                    </div>
                </div>
                
                <!-- Test Timetable Card -->
                <div class="card card-timetable">
                    <h3><i class="fas fa-calendar-alt"></i> Test Timetable</h3>
                    <div class="timetable-wrapper">
                        <table class="test-timetable">
                            <thead>
                                <tr>
                                    <th>Test</th>
                                    <th>Module</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Venue</th>
                                    <th id="admin-action-header" class="hidden">Action</th>
                                </tr>
                            </thead>
                            <tbody id="timetable-body">
                                <!-- Timetable will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Admin Controls for Timetable (Only visible to admins) -->
                    <div class="admin-controls" id="timetable-admin-controls">
                        <h4><i class="fas fa-user-shield"></i> Admin: Manage Test Timetable</h4>
                        <form id="add-timetable-form">
                            <div class="form-group">
                                <label for="timetable-test">Test Name</label>
                                <input type="text" id="timetable-test" placeholder="e.g., Test 01, Midterm, Final">
                            </div>
                            <div class="form-group">
                                <label for="timetable-module">Module</label>
                                <select id="timetable-module">
                                    <option value="">Select Module</option>
                                    <option value="IT101">IT101 - Introduction to Programming</option>
                                    <option value="IT102">IT102 - Web Development Fundamentals</option>
                                    <option value="IT103">IT103 - Database Management Systems</option>
                                    <option value="IT104">IT104 - Data Structures & Algorithms</option>
                                    <option value="IT105">IT105 - Computer Networks</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="timetable-date">Date</label>
                                <input type="date" id="timetable-date">
                            </div>
                            <div class="form-group">
                                <label for="timetable-time">Time</label>
                                <input type="time" id="timetable-time">
                            </div>
                            <div class="form-group">
                                <label for="timetable-venue">Venue</label>
                                <input type="text" id="timetable-venue" placeholder="e.g., Room 101, Lab 3">
                            </div>
                            <button type="submit" class="btn btn-admin">Add Test</button>
                        </form>
                    </div>
                </div>
                
                <!-- Class Timetable Card -->
                <div class="card card-class-timetable">
                    <h3><i class="fas fa-chalkboard"></i> Class Timetable</h3>
                    <div class="class-timetable-wrapper">
                        <table class="class-timetable">
                            <thead>
                                <tr>
                                    <th>Module Code</th>
                                    <th>Module Name</th>
                                    <th>Lecturer</th>
                                    <th>Day</th>
                                    <th>Time</th>
                                    <th>Venue</th>
                                    <th id="admin-class-action-header" class="hidden">Action</th>
                                </tr>
                            </thead>
                            <tbody id="class-timetable-body">
                                <!-- Class timetable will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Admin Controls for Class Timetable (Only visible to admins) -->
                    <div class="admin-controls" id="class-timetable-admin-controls">
                        <h4><i class="fas fa-user-shield"></i> Admin: Manage Class Timetable</h4>
                        <form id="add-class-timetable-form">
                            <div class="form-group">
                                <label for="class-module-code">Module Code</label>
                                <input type="text" id="class-module-code" placeholder="e.g., IT101" required>
                            </div>
                            <div class="form-group">
                                <label for="class-module-name">Module Name</label>
                                <input type="text" id="class-module-name" placeholder="e.g., Introduction to Programming" required>
                            </div>
                            <div class="form-group">
                                <label for="class-lecturer-name">Lecturer Name</label>
                                <input type="text" id="class-lecturer-name" placeholder="Enter lecturer's full name" required>
                            </div>
                            <div class="form-group">
                                <label for="class-venue">Venue</label>
                                <input type="text" id="class-venue" placeholder="e.g., Room 101, Lab 3" required>
                            </div>
                            <div class="form-group">
                                <label for="class-day">Day of Week</label>
                                <select id="class-day" required>
                                    <option value="">Select Day</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                    <option value="Sunday">Sunday</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="class-start-time">Start Time</label>
                                    <input type="time" id="class-start-time" required>
                                </div>
                                <div class="form-group">
                                    <label for="class-end-time">End Time</label>
                                    <input type="time" id="class-end-time" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-admin">Add Class Session</button>
                        </form>
                    </div>
                </div>
                
                <!-- Study Notes Card -->
                <div class="card card-notes">
                    <h3><i class="fas fa-file-alt"></i> Study Notes</h3>
                    <div class="notes-wrapper">
                        <div class="notes-controls">
                            <div class="search-filter-group">
                                <input type="text" id="user-search-notes" placeholder="Search notes by title or module...">
                                <select id="user-filter-notes">
                                    <option value="">All Types</option>
                                    <option value="lecture">Lecture Notes</option>
                                    <option value="tutorial">Tutorial Notes</option>
                                    <option value="assignment">Assignment Guidelines</option>
                                    <option value="exam">Exam Preparation</option>
                                    <option value="reference">Reference Material</option>
                                </select>
                            </div>
                        </div>
                        <div class="notes-list" id="user-notes-list">
                            <div class="no-notes-message">
                                <i class="fas fa-file-alt"></i>
                                <p>No study notes available yet.</p>
                                <p>Admin will add study materials for your courses.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Discussion Forum Tab -->
        <div class="tab-content" id="discussion-forum">
            <div class="forum-container">
                <h2 class="page-title"><i class="fas fa-comments"></i> Discussion Forum</h2>
                <div class="message" id="forum-message"></div>
                
                <!-- Discussions List -->
                <div class="discussions-list">
                    <h3><i class="fas fa-list"></i> Recent Discussions</h3>
                    <div id="discussions-container">
                        <div class="no-discussions">
                            <i class="fas fa-comments"></i>
                            <p>No discussions yet. Admin will post discussions here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Discussion View Modal -->
        <div id="discussion-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-comments"></i> Discussion Details</h3>
                    <button class="close-btn" onclick="closeDiscussionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="discussion-detail-content">
                        <!-- Discussion details will be loaded here -->
                    </div>
                    
                    <!-- Reply Section -->
                    <div class="reply-section">
                        <h4><i class="fas fa-reply"></i> Replies</h4>
                        <div id="replies-container">
                            <!-- Replies will be loaded here -->
                        </div>
                        
                        <!-- Add Reply Form -->
                        <div class="add-reply-form" id="add-reply-form">
                            <h5><i class="fas fa-plus"></i> Add Your Reply</h5>
                            <form id="reply-form">
                                <div class="form-group">
                                    <textarea id="reply-content" required placeholder="Write your reply..." rows="4"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> Post Reply
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Assignments Tab -->
        <div class="tab-content" id="assignments">
            <div class="assignments-container">
                <h2 class="page-title"><i class="fas fa-tasks"></i> Assignments</h2>
                <div class="message" id="assignments-message"></div>
                
                <!-- Assignment Notifications -->
                <div class="notifications-section" id="assignment-notifications">
                    <h3><i class="fas fa-bell"></i> Assignment Notifications</h3>
                    <div id="notifications-container">
                        <div class="no-notifications">
                            <i class="fas fa-bell-slash"></i>
                            <p>No new assignment notifications</p>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Assignment Management -->
                <div class="admin-assignments-section" id="admin-assignments-section" style="display: none;">
                    <h3><i class="fas fa-user-shield"></i> Post New Assignment</h3>
                    <form id="create-assignment-form">
                        <div class="form-group">
                            <label for="assignment-title">Assignment Title</label>
                            <input type="text" id="assignment-title" required placeholder="Enter assignment title">
                        </div>
                        <div class="form-group">
                            <label for="assignment-module">Module</label>
                            <select id="assignment-module" required>
                                <option value="">Select Module</option>
                                <option value="IT101">IT101 - Introduction to Programming</option>
                                <option value="IT102">IT102 - Web Development Fundamentals</option>
                                <option value="IT103">IT103 - Database Management Systems</option>
                                <option value="IT104">IT104 - Data Structures & Algorithms</option>
                                <option value="IT105">IT105 - Computer Networks</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="assignment-description">Assignment Description</label>
                            <textarea id="assignment-description" required placeholder="Enter assignment details and requirements..." rows="6"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="assignment-due-date">Due Date & Time</label>
                            <input type="datetime-local" id="assignment-due-date" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Post Assignment
                        </button>
                    </form>
                </div>
                
                <!-- Assignments List -->
                <div class="assignments-list">
                    <h3><i class="fas fa-list"></i> All Assignments</h3>
                    <div id="assignments-container">
                        <div class="no-assignments">
                            <i class="fas fa-tasks"></i>
                            <p>No assignments posted yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div class="mobile-nav" id="mobile-nav">
            <div class="mobile-nav-content">
                <div class="mobile-nav-header">
                    <h3><i class="fas fa-laptop-code"></i> IT Course Management</h3>
                    <button class="mobile-close-btn" id="mobile-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-nav-tabs">
                    <button class="mobile-nav-tab" data-tab="login">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button class="mobile-nav-tab" data-tab="register">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                    <button class="mobile-nav-tab" data-tab="about">
                        <i class="fas fa-info-circle"></i> About
                    </button>
                    <button class="mobile-nav-tab" data-tab="contact">
                        <i class="fas fa-envelope"></i> Contact
                    </button>
                    <button class="mobile-nav-tab" data-tab="zoom-meeting">
                        <i class="fas fa-video"></i> Zoom Meeting
                    </button>
                    <button class="mobile-nav-tab" data-tab="news">
                        <i class="fas fa-newspaper"></i> News & Info
                    </button>
                    <button class="mobile-nav-tab" data-tab="ads">
                        <i class="fas fa-ad"></i> Ads
                    </button>
                    <button class="mobile-nav-tab hidden" data-tab="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="mobile-nav-tab hidden" data-tab="discussion-forum">
                        <i class="fas fa-comments"></i> Discussion Forum
                    </button>
                    <button class="mobile-nav-tab hidden" data-tab="assignments">
                        <i class="fas fa-tasks"></i> Assignments
                    </button>
                </div>
            </div>
        </div>

   <script src="working-script.js"></script>
   <script>
        // Mobile Navigation Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileNav = document.getElementById('mobile-nav');
            const mobileCloseBtn = document.getElementById('mobile-close-btn');
            const mobileNavTabs = document.querySelectorAll('.mobile-nav-tab');
            
            // Toggle mobile menu
            mobileMenuToggle.addEventListener('click', function() {
                mobileNav.style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
            
            // Close mobile menu
            mobileCloseBtn.addEventListener('click', function() {
                mobileNav.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Handle mobile tab clicks
            mobileNavTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Close mobile menu
                    mobileNav.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Switch to the selected tab using existing function
                    if (typeof switchToTab === 'function') {
                        switchToTab(tabName);
                    } else {
                        // Fallback: trigger click on desktop tab
                        const desktopTab = document.querySelector(`[data-tab="${tabName}"]`);
                        if (desktopTab) {
                            desktopTab.click();
                        }
                    }
                });
            });
            
            // Close mobile menu when clicking outside
            mobileNav.addEventListener('click', function(e) {
                if (e.target === mobileNav) {
                    mobileNav.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Handle escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && mobileNav.style.display === 'block') {
                    mobileNav.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Update mobile nav tabs when user logs in/out
            updateMobileNavTabs();
        });
        
        // Update mobile navigation tabs based on login status
        function updateMobileNavTabs() {
            const isLoggedIn = document.getElementById('user-profile-header').classList.contains('hidden') === false;
            const mobileNavTabs = document.querySelectorAll('.mobile-nav-tab');
            
            mobileNavTabs.forEach(tab => {
                const tabName = tab.getAttribute('data-tab');
                
                if (isLoggedIn) {
                    // Show logged-in tabs
                    if (['dashboard', 'discussion-forum', 'assignments'].includes(tabName)) {
                        tab.classList.remove('hidden');
                    }
                    if (['login', 'register'].includes(tabName)) {
                        tab.classList.add('hidden');
                    }
                } else {
                    // Show logged-out tabs
                    if (['login', 'register', 'news', 'ads'].includes(tabName)) {
                        tab.classList.remove('hidden');
                    }
                    if (['dashboard', 'discussion-forum', 'assignments'].includes(tabName)) {
                        tab.classList.add('hidden');
                    }
                }
            });
        }
        
        // Add touch gestures for mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe left - could trigger next tab
                    console.log('Swipe left detected');
                } else {
                    // Swipe right - could open mobile menu
                    const mobileNav = document.getElementById('mobile-nav');
                    if (mobileNav.style.display === 'none' || mobileNav.style.display === '') {
                        mobileNav.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                    }
                }
            }
        }
        
        // Optimize for mobile performance
        if ('serviceWorker' in navigator) {
            // Register service worker for PWA capabilities
            navigator.serviceWorker.register('/sw.js').catch(function() {
                console.log('Service Worker registration failed');
            });
        }
        
        // Add mobile-specific optimizations
        function optimizeForMobile() {
            // Prevent double-tap zoom
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            });
            
            // Add smooth scrolling
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Optimize images for mobile
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.loading = 'lazy';
            });
        }
        
        // Initialize mobile optimizations
        optimizeForMobile();
        
        // Listen for login/logout events to update mobile nav
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    updateMobileNavTabs();
                }
            });
        });
        
        const userProfileHeader = document.getElementById('user-profile-header');
        if (userProfileHeader) {
            observer.observe(userProfileHeader, { attributes: true });
        }

        // News and Ads Management Functions
        async function loadNews() {
            try {
                const response = await fetch('/api/news');
                const data = await response.json();
                
                const newsList = document.getElementById('news-list');
                if (data.success && data.data && data.data.length > 0) {
                    newsList.innerHTML = data.data.map(news => `
                        <div class="news-item" data-news-id="${news.id}">
                            <div class="news-item-header">
                                <div>
                                    <h3 class="news-item-title">${news.title}</h3>
                                    <div class="news-item-meta">
                                        <span class="news-date">${new Date(news.created_at).toLocaleDateString()}</span>
                                        <span class="news-views">${news.view_count || 0} views</span>
                                        <span class="news-author">By ${news.created_by_name || 'Unknown'}</span>
                                    </div>
                                </div>
                            </div>
                            ${news.image_url ? `<img src="${news.image_url}" alt="${news.title}" class="news-item-image">` : ''}
                            <div class="news-item-content">${news.content}</div>
                        </div>
                    `).join('');
                    
                    // Track views for all loaded news articles immediately
                    data.data.forEach(news => trackNewsView(news.id));
                } else {
                    newsList.innerHTML = `
                        <div class="no-news-message">
                            <i class="fas fa-newspaper"></i>
                            <p>No news articles available yet.</p>
                            <p>Admin will post news and updates here.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading news:', error);
            }
        }

        async function loadAds() {
            try {
                const response = await fetch('/api/ads');
                const data = await response.json();
                
                // Get all containers
                const videoAdsContainer = document.getElementById('video-ads');
                const bannerAdsContainer = document.getElementById('banner-ads');
                const popupAdsContainer = document.getElementById('popup-ads');
                const topAdsContainer = document.getElementById('top-ads');
                const sidebarAdsContainer = document.getElementById('sidebar-ads');
                const bottomAdsContainer = document.getElementById('bottom-ads');
                const popupPositionAdsContainer = document.getElementById('popup-position-ads');
                
                if (data.success && data.data && data.data.length > 0) {
                    // Filter ads by type
                    const videoAds = data.data.filter(ad => ad.ad_type === 'video');
                    const bannerAds = data.data.filter(ad => ad.ad_type === 'banner');
                    const popupAds = data.data.filter(ad => ad.ad_type === 'popup');
                    
                    // Filter ads by position
                    const topAds = data.data.filter(ad => ad.position === 'top');
                    const sidebarAds = data.data.filter(ad => ad.position === 'sidebar');
                    const bottomAds = data.data.filter(ad => ad.position === 'bottom');
                    const popupPositionAds = data.data.filter(ad => ad.position === 'popup');
                    
                    // Load video ads
                    if (videoAds.length > 0) {
                        videoAdsContainer.innerHTML = videoAds.map(ad => `
                            <div class="video-ad" data-ad-id="${ad.id}">
                                <div class="video-player">
                                    <video ${ad.auto_play ? 'autoplay muted loop' : ''} controls>
                                        <source src="${ad.video_url}" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                    <div class="video-controls">
                                        <button class="mute-btn" onclick="toggleMute(this)">
                                            <i class="fas fa-volume-mute"></i>
                                        </button>
                                    </div>
                                </div>
                                <h4 class="ad-title">${ad.title}</h4>
                                <p class="ad-description">${ad.description}</p>
                                <a href="${ad.redirect_url}" target="_blank" class="ad-redirect-btn" onclick="trackAdClick(${ad.id})">
                                    Learn More <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        `).join('');
                    } else {
                        videoAdsContainer.innerHTML = `
                            <div class="no-ads-message">
                                <i class="fas fa-video"></i>
                                <p>No video ads available at the moment.</p>
                            </div>
                        `;
                    }
                    
                    // Load banner ads
                    if (bannerAds.length > 0) {
                        bannerAdsContainer.innerHTML = bannerAds.map(ad => `
                            <div class="banner-ad" data-ad-id="${ad.id}">
                                <img src="${ad.image_url || ad.video_url}" alt="${ad.title}" style="width: 100%; border-radius: 8px;" onerror="this.src='https://picsum.photos/seed/ad-${ad.id}/400/200.jpg'">
                                <h4 class="ad-title">${ad.title}</h4>
                                <p class="ad-description">${ad.description}</p>
                                <a href="${ad.redirect_url}" target="_blank" class="ad-redirect-btn" onclick="trackAdClick(${ad.id})">
                                    Learn More <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        `).join('');
                    } else {
                        bannerAdsContainer.innerHTML = `
                            <div class="no-ads-message">
                                <i class="fas fa-image"></i>
                                <p>No banner ads available at the moment.</p>
                            </div>
                        `;
                    }
                    
                    // Load popup ads
                    if (popupAds.length > 0) {
                        popupAdsContainer.innerHTML = popupAds.map(ad => `
                            <div class="popup-ad" data-ad-id="${ad.id}">
                                <div class="popup-content">
                                    <img src="${ad.image_url || ad.video_url}" alt="${ad.title}" style="width: 100%; border-radius: 8px;" onerror="this.src='https://picsum.photos/seed/ad-${ad.id}/400/200.jpg'">
                                    <h4 class="ad-title">${ad.title}</h4>
                                    <p class="ad-description">${ad.description}</p>
                                    <a href="${ad.redirect_url}" target="_blank" class="ad-redirect-btn" onclick="trackAdClick(${ad.id})">
                                        Learn More <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        popupAdsContainer.innerHTML = `
                            <div class="no-ads-message">
                                <i class="fas fa-window-restore"></i>
                                <p>No popup ads available at the moment.</p>
                            </div>
                        `;
                    }
                    
                    // Load position-based ads
                    const renderPositionAd = (ad, container) => {
                        if (ad.ad_type === 'video') {
                            container.innerHTML = `
                                <div class="position-ad video-ad" data-ad-id="${ad.id}">
                                    <div class="video-player">
                                        <video ${ad.auto_play ? 'autoplay muted loop' : ''} controls>
                                            <source src="${ad.video_url}" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                    </div>
                                    <h4 class="ad-title">${ad.title}</h4>
                                    <p class="ad-description">${ad.description}</p>
                                    <a href="${ad.redirect_url}" target="_blank" class="ad-redirect-btn" onclick="trackAdClick(${ad.id})">
                                        Learn More <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            `;
                        } else if (ad.ad_type === 'banner') {
                            container.innerHTML = `
                                <div class="position-ad banner-ad" data-ad-id="${ad.id}">
                                    <img src="${ad.image_url || ad.video_url}" alt="${ad.title}" style="width: 100%; border-radius: 8px;" onerror="this.src='https://picsum.photos/seed/ad-${ad.id}/400/200.jpg'">
                                    <h4 class="ad-title">${ad.title}</h4>
                                    <p class="ad-description">${ad.description}</p>
                                    <a href="${ad.redirect_url}" target="_blank" class="ad-redirect-btn" onclick="trackAdClick(${ad.id})">
                                        Learn More <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            `;
                        } else if (ad.ad_type === 'popup') {
                            container.innerHTML = `
                                <div class="position-ad popup-ad" data-ad-id="${ad.id}">
                                    <div class="popup-content">
                                        <img src="${ad.image_url || ad.video_url}" alt="${ad.title}" style="width: 100%; border-radius: 8px;" onerror="this.src='https://picsum.photos/seed/ad-${ad.id}/400/200.jpg'">
                                        <h4 class="ad-title">${ad.title}</h4>
                                        <p class="ad-description">${ad.description}</p>
                                        <a href="${ad.redirect_url}" target="_blank" class="ad-redirect-btn" onclick="trackAdClick(${ad.id})">
                                            Learn More <i class="fas fa-external-link-alt"></i>
                                        </a>
                                    </div>
                                </div>
                            `;
                        }
                    };
                    
                    // Render position-based ads
                    if (topAds.length > 0) {
                        renderPositionAd(topAds[0], topAdsContainer);
                    } else {
                        topAdsContainer.innerHTML = '<div class="no-ads-message"><p>No top position ads available.</p></div>';
                    }
                    
                    if (sidebarAds.length > 0) {
                        renderPositionAd(sidebarAds[0], sidebarAdsContainer);
                    } else {
                        sidebarAdsContainer.innerHTML = '<div class="no-ads-message"><p>No sidebar position ads available.</p></div>';
                    }
                    
                    if (bottomAds.length > 0) {
                        renderPositionAd(bottomAds[0], bottomAdsContainer);
                    } else {
                        bottomAdsContainer.innerHTML = '<div class="no-ads-message"><p>No bottom position ads available.</p></div>';
                    }
                    
                    if (popupPositionAds.length > 0) {
                        renderPositionAd(popupPositionAds[0], popupPositionAdsContainer);
                    } else {
                        popupPositionAdsContainer.innerHTML = '<div class="no-ads-message"><p>No popup position ads available.</p></div>';
                    }
                    
                    // Track views for all ads
                    data.data.forEach(ad => trackAdView(ad.id));
                } else {
                    // Clear all containers
                    videoAdsContainer.innerHTML = '<div class="no-ads-message"><i class="fas fa-video"></i><p>No video ads available at the moment.</p></div>';
                    bannerAdsContainer.innerHTML = '<div class="no-ads-message"><i class="fas fa-image"></i><p>No banner ads available at the moment.</p></div>';
                    popupAdsContainer.innerHTML = '<div class="no-ads-message"><i class="fas fa-window-restore"></i><p>No popup ads available at the moment.</p></div>';
                    topAdsContainer.innerHTML = '<div class="no-ads-message"><p>No top position ads available.</p></div>';
                    sidebarAdsContainer.innerHTML = '<div class="no-ads-message"><p>No sidebar position ads available.</p></div>';
                    bottomAdsContainer.innerHTML = '<div class="no-ads-message"><p>No bottom position ads available.</p></div>';
                    popupPositionAdsContainer.innerHTML = '<div class="no-ads-message"><p>No popup position ads available.</p></div>';
                }
            } catch (error) {
                console.error('Error loading ads:', error);
            }
        }

        function toggleMute(button) {
            const video = button.closest('.video-ad').querySelector('video');
            const icon = button.querySelector('i');
            
            if (video.muted) {
                video.muted = false;
                icon.className = 'fas fa-volume-up';
            } else {
                video.muted = true;
                icon.className = 'fas fa-volume-mute';
            }
        }

        async function trackAdView(adId) {
            try {
                await fetch('/api/ads/track-view', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ad_id: adId })
                });
            } catch (error) {
                console.error('Error tracking ad view:', error);
            }
        }

        async function trackAdClick(adId) {
            try {
                await fetch('/api/ads/track-click', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ad_id: adId })
                });
            } catch (error) {
                console.error('Error tracking ad click:', error);
            }
        }

        // Filter functionality
        document.getElementById('news-category-filter')?.addEventListener('change', loadNews);
        document.getElementById('news-priority-filter')?.addEventListener('change', loadNews);

        // Track news views when displayed
        document.addEventListener('DOMContentLoaded', function() {
            // Track views for news articles when they are displayed
            const trackNewsView = async (newsId) => {
                try {
                    await fetch('/api/news/track-view', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ news_id: newsId })
                    });
                } catch (error) {
                    console.error('Error tracking news view:', error);
                }
            };
            
            // Track views for all visible news articles
            const trackAllNewsViews = async () => {
                const newsItems = document.querySelectorAll('.news-item');
                newsItems.forEach(item => {
                    const newsId = item.getAttribute('data-news-id');
                    if (newsId) {
                        trackNewsView(newsId);
                    }
                });
            };
            
            // Track views periodically
            setInterval(trackAllNewsViews, 30000); // Track every 30 seconds
        });
        
        // Load news and ads when tabs are opened
        document.addEventListener('DOMContentLoaded', function() {
            // Load news and ads when their tabs are clicked
            document.querySelector('[data-tab="news"]')?.addEventListener('click', loadNews);
            document.querySelector('[data-tab="ads"]')?.addEventListener('click', loadAds);
            document.querySelector('[data-tab="discussion-forum"]')?.addEventListener('click', loadDiscussions);
            
            // Start auto-refresh intervals
            setInterval(() => {
                // Check if tabs are active and refresh data
                if (document.getElementById('news').classList.contains('active')) {
                    loadNews();
                }
                if (document.getElementById('ads').classList.contains('active')) {
                    loadAds();
                }
                if (document.getElementById('discussion-forum').classList.contains('active')) {
                    loadDiscussions();
                }
            }, 30000); // Refresh every 30 seconds
        });
        
        // Auto-refresh discussions function for main interface
        async function loadDiscussions() {
            try {
                const response = await fetch('/api/discussions');
                const data = await response.json();
                
                const discussionsContainer = document.getElementById('discussions-container');
                if (data.success && data.data && data.data.length > 0) {
                    discussionsContainer.innerHTML = data.data.map(discussion => `
                        <div class="discussion-item" onclick="viewDiscussion(${discussion.id})">
                            <div class="discussion-header">
                                <h4>${discussion.title}</h4>
                                <div class="discussion-meta">
                                    <span class="discussion-module">${discussion.module_code || 'General'}</span>
                                    <span class="discussion-date">${new Date(discussion.created_at).toLocaleDateString()}</span>
                                    <span class="discussion-author">By ${discussion.author_name || 'Admin'}</span>
                                </div>
                            </div>
                            <div class="discussion-content">
                                <p>${discussion.content.substring(0, 200)}${discussion.content.length > 200 ? '...' : ''}</p>
                            </div>
                            <div class="discussion-stats">
                                <span><i class="fas fa-comments"></i> ${discussion.reply_count || 0} replies</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    discussionsContainer.innerHTML = `
                        <div class="no-discussions">
                            <i class="fas fa-comments"></i>
                            <p>No discussions yet. Admin will post discussions here.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading discussions:', error);
            }
        }
        
        // View discussion function
        function viewDiscussion(id) {
            // Open discussion modal or navigate to discussion detail
            window.openDiscussionModal(id);
        }
        
        // Discussion Modal Functions
        window.openDiscussionModal = async (id) => {
            try {
                const response = await fetch(`/api/discussions/${id}`);
                const data = await response.json();
                
                if (data.success) {
                    const discussion = data.data.discussion;
                    const replies = data.data.replies;
                    
                    // Display discussion details
                    document.getElementById('discussion-detail-content').innerHTML = `
                        <div class="discussion-detail">
                            <h4>${discussion.title}</h4>
                            <div class="discussion-meta">
                                <span class="discussion-module">${discussion.module_code || 'General'}</span>
                                <span class="discussion-date">${new Date(discussion.created_at).toLocaleDateString()}</span>
                                <span class="discussion-author">By ${discussion.author_name || 'Admin'}</span>
                            </div>
                            <div class="discussion-content-full">
                                <p>${discussion.content}</p>
                            </div>
                        </div>
                    `;
                    
                    // Display replies
                    const repliesContainer = document.getElementById('replies-container');
                    if (replies && replies.length > 0) {
                        repliesContainer.innerHTML = replies.map(reply => `
                            <div class="reply-item">
                                <div class="reply-header">
                                    <strong>${reply.author_name || 'Anonymous'}</strong>
                                    <small class="reply-date">${new Date(reply.created_at).toLocaleDateString()}</small>
                                </div>
                                <div class="reply-content">
                                    <p>${reply.content}</p>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        repliesContainer.innerHTML = '<p class="text-muted">No replies yet. Be the first to reply!</p>';
                    }
                    
                    // Show modal
                    document.getElementById('discussion-modal').style.display = 'block';
                    
                    // Set up reply form
                    setupReplyForm(id);
                } else {
                    console.error('Failed to load discussion:', data.message);
                }
            } catch (error) {
                console.error('Error loading discussion:', error);
            }
        };
        
        window.closeDiscussionModal = () => {
            document.getElementById('discussion-modal').style.display = 'none';
        };
        
        function setupReplyForm(discussionId) {
            const replyForm = document.getElementById('reply-form');
            
            // Remove existing event listener
            const newReplyForm = replyForm.cloneNode(true);
            replyForm.parentNode.replaceChild(newReplyForm, replyForm);
            
            // Add new event listener
            newReplyForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const replyContent = document.getElementById('reply-content').value;
                
                if (!replyContent.trim()) {
                    alert('Please write a reply before submitting.');
                    return;
                }
                
                try {
                    // Get current user from secure session
                    const userResponse = await fetch('/api/discussions/current-user');
                    const userData = await userResponse.json();
                    
                    let userId = null;
                    let userName = 'Anonymous';
                    
                    if (userData.success && userData.data) {
                        userId = userData.data.id;
                        userName = userData.data.name;
                    }
                    
                    const response = await fetch(`/api/discussions/${discussionId}/replies`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            content: replyContent,
                            user_id: userId,
                            user_name: userName
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Clear form
                        document.getElementById('reply-content').value = '';
                        
                        // Reload discussion to show new reply
                        window.openDiscussionModal(discussionId);
                        
                        // Show success message
                        alert('Reply posted successfully!');
                        
                        // Refresh discussions list
                        loadDiscussions();
                    } else {
                        alert('Failed to post reply: ' + (data.message || 'Unknown error'));
                    }
                } catch (error) {
                    console.error('Error posting reply:', error);
                    alert('Failed to post reply. Please try again.');
                }
            });
        }
        
        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('discussion-modal');
            if (e.target === modal) {
                closeDiscussionModal();
            }
        });
   </script>
</body>
</html>