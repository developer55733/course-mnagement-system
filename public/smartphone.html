<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Course Management - Mobile</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="smartphone.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Hide desktop content by default */
        .desktop-only, .tablet-only {
            display: none;
        }
        
        /* Show smartphone content only on mobile */
        .smartphone-app {
            display: none;
        }
        
        /* Media query to show smartphone app only on mobile */
        @media screen and (max-width: 480px) {
            .smartphone-app {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <!-- Desktop/Tablet Content (Hidden on Mobile) -->
    <div class="desktop-only">
        <!-- Original desktop content goes here -->
        <div class="app-container">
            <header class="app-header">
                <div class="header-content">
                    <h1><i class="fas fa-graduation-cap"></i> Course Management System</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="dashboard-username">Guest User</div>
                            <div class="user-role">Student</div>
                        </div>
                    </div>
                </div>
            </header>
            
            <nav class="app-nav">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </button>
                    <button class="nav-tab" data-tab="modules">
                        <i class="fas fa-book"></i>
                        <span>Modules</span>
                    </button>
                    <button class="nav-tab" data-tab="lecturers">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Lecturers</span>
                    </button>
                    <button class="nav-tab" data-tab="timetable">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Timetable</span>
                    </button>
                    <button class="nav-tab devadmin-tab" data-tab="devadmin">
                        <i class="fas fa-cog"></i>
                        <span>Admin</span>
                    </button>
                </div>
            </nav>
            
            <main class="app-main">
                <div class="tab-content active" id="dashboard-tab">
                    <!-- Desktop dashboard content -->
                </div>
            </main>
        </div>
    </div>
    
    <!-- Smartphone-Only Content -->
    <div class="smartphone-app">
        <!-- Smartphone Header -->
        <header class="smartphone-header">
            <h1><i class="fas fa-graduation-cap"></i> Courses</h1>
            <div class="smartphone-user-avatar" id="smartphone-user-avatar">U</div>
        </header>
        
        <!-- Smartphone Content Area -->
        <main class="smartphone-content" id="smartphone-content">
            <!-- Login Screen (shown when not logged in) -->
            <div class="smartphone-login" id="smartphone-login">
                <div class="smartphone-login-card">
                    <h2 class="smartphone-login-title">
                        <i class="fas fa-graduation-cap"></i> Course Portal
                    </h2>
                    
                    <div class="smartphone-input-group">
                        <input type="email" class="smartphone-input" id="smartphone-email" placeholder="Email Address">
                    </div>
                    
                    <div class="smartphone-input-group">
                        <input type="password" class="smartphone-input" id="smartphone-password" placeholder="Password">
                    </div>
                    
                    <button class="smartphone-login-btn" id="smartphone-login-btn">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                    
                    <div style="margin-top: 20px; text-align: center; color: #666; font-size: 12px;">
                        <div>Student: john@student.edu</div>
                        <div>Password: password123</div>
                    </div>
                </div>
            </div>
            
            <!-- Main App Content (shown when logged in) -->
            <div class="smartphone-main" id="smartphone-main" style="display: none;">
                <!-- Search Bar -->
                <div class="smartphone-search-container">
                    <input type="text" class="smartphone-search-input" id="smartphone-search" placeholder="Search notes...">
                    <i class="fas fa-search smartphone-search-icon"></i>
                </div>
                
                <!-- Filter Pills -->
                <div class="smartphone-filter-container">
                    <button class="smartphone-filter-pill active" data-filter="all">All Notes</button>
                    <button class="smartphone-filter-pill" data-filter="lecture">Lectures</button>
                    <button class="smartphone-filter-pill" data-filter="tutorial">Tutorials</button>
                    <button class="smartphone-filter-pill" data-filter="assignment">Assignments</button>
                </div>
                
                <!-- Notes Container -->
                <div class="smartphone-notes-container" id="smartphone-notes-container">
                    <div class="smartphone-loading">Loading notes...</div>
                </div>
            </div>
        </main>
        
        <!-- Smartphone Bottom Navigation -->
        <nav class="smartphone-nav">
            <button class="smartphone-nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="smartphone-nav-item" data-page="modules">
                <i class="fas fa-book"></i>
                <span>Modules</span>
            </button>
            <button class="smartphone-nav-item" data-page="search">
                <i class="fas fa-search"></i>
                <span>Search</span>
            </button>
            <button class="smartphone-nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
        </nav>
    </div>
    
    <!-- Include the main script -->
    <script src="working-script.js"></script>
    
    <!-- Smartphone-specific JavaScript -->
    <script>
        // Smartphone UI Controller
        class SmartphoneUI {
            constructor() {
                this.currentPage = 'home';
                this.currentFilter = 'all';
                this.currentUser = null;
                this.notes = [];
                this.init();
            }
            
            init() {
                // Check if we're on a smartphone
                if (window.innerWidth <= 480) {
                    this.setupEventListeners();
                    this.checkLoginStatus();
                    console.log('ðŸ“± Smartphone UI initialized');
                }
            }
            
            setupEventListeners() {
                // Login button
                const loginBtn = document.getElementById('smartphone-login-btn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', () => this.handleLogin());
                }
                
                // Bottom navigation
                const navItems = document.querySelectorAll('.smartphone-nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        const page = e.currentTarget.dataset.page;
                        this.switchPage(page);
                    });
                });
                
                // Filter pills
                const filterPills = document.querySelectorAll('.smartphone-filter-pill');
                filterPills.forEach(pill => {
                    pill.addEventListener('click', (e) => {
                        const filter = e.currentTarget.dataset.filter;
                        this.filterNotes(filter);
                    });
                });
                
                // Search input
                const searchInput = document.getElementById('smartphone-search');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchNotes(e.target.value);
                    });
                }
                
                // Enter key on login form
                const passwordInput = document.getElementById('smartphone-password');
                if (passwordInput) {
                    passwordInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleLogin();
                        }
                    });
                }
            }
            
            checkLoginStatus() {
                // Check if user is logged in (using existing global variable)
                if (typeof currentUser !== 'undefined' && currentUser) {
                    this.currentUser = currentUser;
                    this.showMainApp();
                    this.loadNotes();
                } else {
                    this.showLogin();
                }
            }
            
            async handleLogin() {
                const email = document.getElementById('smartphone-email').value;
                const password = document.getElementById('smartphone-password').value;
                
                if (!email || !password) {
                    this.showToast('Please enter email and password', 'error');
                    return;
                }
                
                try {
                    // Use existing login function from main script
                    if (typeof login === 'function') {
                        await login(email, password);
                        // Check if login was successful
                        setTimeout(() => {
                            if (typeof currentUser !== 'undefined' && currentUser) {
                                this.currentUser = currentUser;
                                this.showMainApp();
                                this.loadNotes();
                                this.showToast('Login successful!', 'success');
                            }
                        }, 1000);
                    }
                } catch (error) {
                    this.showToast('Login failed. Please try again.', 'error');
                }
            }
            
            showLogin() {
                document.getElementById('smartphone-login').style.display = 'flex';
                document.getElementById('smartphone-main').style.display = 'none';
            }
            
            showMainApp() {
                document.getElementById('smartphone-login').style.display = 'none';
                document.getElementById('smartphone-main').style.display = 'block';
                
                // Update user avatar
                if (this.currentUser && this.currentUser.name) {
                    const avatar = document.getElementById('smartphone-user-avatar');
                    if (avatar) {
                        avatar.textContent = this.currentUser.name.charAt(0).toUpperCase();
                    }
                }
            }
            
            switchPage(page) {
                // Update active nav item
                document.querySelectorAll('.smartphone-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-page="${page}"]`).classList.add('active');
                
                this.currentPage = page;
                
                // Handle page switching
                switch(page) {
                    case 'home':
                        this.showHome();
                        break;
                    case 'modules':
                        this.showModules();
                        break;
                    case 'search':
                        this.showSearch();
                        break;
                    case 'profile':
                        this.showProfile();
                        break;
                }
            }
            
            showHome() {
                // Show notes (already loaded)
                console.log('ðŸ“± Showing home page with notes');
            }
            
            showModules() {
                // Show modules page
                const container = document.getElementById('smartphone-notes-container');
                container.innerHTML = `
                    <div class="smartphone-loading">Loading modules...</div>
                `;
                // Load modules using existing function
                if (typeof loadModules === 'function') {
                    setTimeout(() => {
                        this.displayModules();
                    }, 1000);
                }
            }
            
            showSearch() {
                // Focus on search
                const searchInput = document.getElementById('smartphone-search');
                if (searchInput) {
                    searchInput.focus();
                }
            }
            
            showProfile() {
                // Show profile page
                const container = document.getElementById('smartphone-notes-container');
                if (this.currentUser) {
                    container.innerHTML = `
                        <div class="smartphone-note-card">
                            <h3 class="smartphone-note-title">Profile</h3>
                            <div style="padding: 20px 0;">
                                <div style="margin-bottom: 15px;">
                                    <strong>Name:</strong> ${this.currentUser.name || 'N/A'}
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong>Email:</strong> ${this.currentUser.email || 'N/A'}
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong>Role:</strong> ${this.currentUser.role || 'Student'}
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong>Student ID:</strong> ${this.currentUser.studentId || 'N/A'}
                                </div>
                                <button class="smartphone-download-btn" onclick="smartphoneUI.logout()">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            async loadNotes() {
                try {
                    // Use existing loadUserNotes function
                    if (typeof loadUserNotes === 'function') {
                        await loadUserNotes();
                        // Get notes from the DOM after loading
                        setTimeout(() => {
                            this.extractNotesFromDOM();
                        }, 2000);
                    }
                } catch (error) {
                    console.error('ðŸ“± Error loading notes:', error);
                    this.showError('Failed to load notes');
                }
            }
            
            extractNotesFromDOM() {
                // Extract notes from the main DOM (desktop version)
                const notesElements = document.querySelectorAll('#user-notes-list .note-card');
                this.notes = Array.from(notesElements).map(el => ({
                    id: el.dataset.noteId,
                    title: el.querySelector('.note-title')?.textContent || '',
                    content: el.querySelector('.note-content')?.textContent || '',
                    type: el.querySelector('.note-type')?.textContent || '',
                    module: el.querySelector('.note-module')?.textContent || '',
                    date: el.querySelector('.note-date')?.textContent || '',
                    downloadUrl: el.querySelector('.download-note')?.href || ''
                }));
                
                this.displayNotes();
            }
            
            displayNotes() {
                const container = document.getElementById('smartphone-notes-container');
                
                if (this.notes.length === 0) {
                    container.innerHTML = `
                        <div class="smartphone-empty">
                            <div class="smartphone-empty-icon">
                                <i class="fas fa-sticky-note"></i>
                            </div>
                            <div class="smartphone-empty-text">No notes available</div>
                            <div class="smartphone-empty-subtext">Check back later for new content</div>
                        </div>
                    `;
                    return;
                }
                
                const filteredNotes = this.getFilteredNotes();
                
                container.innerHTML = filteredNotes.map(note => `
                    <div class="smartphone-note-card">
                        <h3 class="smartphone-note-title">${this.escapeHtml(note.title)}</h3>
                        <div class="smartphone-note-meta">
                            <span class="smartphone-note-type">${note.type}</span>
                            <span class="smartphone-note-date">${note.date}</span>
                        </div>
                        <div class="smartphone-note-content">${this.escapeHtml(note.content)}</div>
                        <div class="smartphone-note-actions">
                            <button class="smartphone-download-btn" onclick="smartphoneUI.downloadNote('${note.id}')">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            displayModules() {
                // Get modules from main page
                const modulesElements = document.querySelectorAll('#modules-list .module-item');
                const modules = Array.from(modulesElements).map(el => ({
                    code: el.querySelector('.module-code')?.textContent || '',
                    name: el.querySelector('.module-name')?.textContent || '',
                    lecturer: el.querySelector('.module-lecturer')?.textContent || ''
                }));
                
                const container = document.getElementById('smartphone-notes-container');
                
                if (modules.length === 0) {
                    container.innerHTML = `
                        <div class="smartphone-empty">
                            <div class="smartphone-empty-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="smartphone-empty-text">No modules available</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = modules.map(module => `
                    <div class="smartphone-note-card">
                        <h3 class="smartphone-note-title">${this.escapeHtml(module.name)}</h3>
                        <div class="smartphone-note-meta">
                            <span class="smartphone-note-type">Module</span>
                            <span class="smartphone-note-date">${this.escapeHtml(module.code)}</span>
                        </div>
                        <div class="smartphone-note-content">
                            <strong>Lecturer:</strong> ${this.escapeHtml(module.lecturer)}
                        </div>
                    </div>
                `).join('');
            }
            
            filterNotes(filter) {
                this.currentFilter = filter;
                
                // Update active filter pill
                document.querySelectorAll('.smartphone-filter-pill').forEach(pill => {
                    pill.classList.remove('active');
                });
                document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
                
                this.displayNotes();
            }
            
            getFilteredNotes() {
                if (this.currentFilter === 'all') {
                    return this.notes;
                }
                
                return this.notes.filter(note => 
                    note.type.toLowerCase() === this.currentFilter.toLowerCase()
                );
            }
            
            searchNotes(query) {
                if (!query) {
                    this.displayNotes();
                    return;
                }
                
                const filtered = this.notes.filter(note => 
                    note.title.toLowerCase().includes(query.toLowerCase()) ||
                    note.content.toLowerCase().includes(query.toLowerCase()) ||
                    note.module.toLowerCase().includes(query.toLowerCase())
                );
                
                const container = document.getElementById('smartphone-notes-container');
                
                if (filtered.length === 0) {
                    container.innerHTML = `
                        <div class="smartphone-empty">
                            <div class="smartphone-empty-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="smartphone-empty-text">No results found</div>
                            <div class="smartphone-empty-subtext">Try a different search term</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = filtered.map(note => `
                    <div class="smartphone-note-card">
                        <h3 class="smartphone-note-title">${this.escapeHtml(note.title)}</h3>
                        <div class="smartphone-note-meta">
                            <span class="smartphone-note-type">${note.type}</span>
                            <span class="smartphone-note-date">${note.date}</span>
                        </div>
                        <div class="smartphone-note-content">${this.escapeHtml(note.content)}</div>
                        <div class="smartphone-note-actions">
                            <button class="smartphone-download-btn" onclick="smartphoneUI.downloadNote('${note.id}')">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            downloadNote(noteId) {
                // Use existing download function
                if (typeof downloadNote === 'function') {
                    downloadNote(noteId);
                } else {
                    this.showToast('Download not available', 'error');
                }
            }
            
            logout() {
                // Use existing logout function
                if (typeof logout === 'function') {
                    logout();
                }
                this.currentUser = null;
                this.showLogin();
                this.showToast('Logged out successfully', 'success');
            }
            
            showToast(message, type = 'info') {
                // Create toast notification
                const toast = document.createElement('div');
                toast.className = 'smartphone-toast';
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                `;
                
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#667eea'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 25px;
                    font-size: 14px;
                    font-weight: 500;
                    z-index: 10000;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                    animation: slideDown 0.3s ease;
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            showError(message) {
                const container = document.getElementById('smartphone-notes-container');
                container.innerHTML = `
                    <div class="smartphone-empty">
                        <div class="smartphone-empty-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="smartphone-empty-text">${message}</div>
                        <div class="smartphone-empty-subtext">Please try again later</div>
                    </div>
                `;
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }
        
        // Initialize smartphone UI
        const smartphoneUI = new SmartphoneUI();
        
        // Add toast animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateX(-50%) translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(-50%) translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
